sap.ui.define(["sap/ui/test/Opa5","sap/ui/test/actions/Press","./Common","sap/ui/test/actions/EnterText","sap/ui/test/matchers/AggregationLengthEquals","sap/ui/test/matchers/AggregationFilled","sap/ui/test/matchers/I18NText"],function(e,t,s,i,r,n,o){"use strict";e.createPageObjects({onTheMasterPage:{baseClass:s,viewName:"Master",actions:{iSortTheListOnName:function(){return this.iChooseASorter("sortButton","masterSort1")},iSortTheListOnUnitNumber:function(){return this.iChooseASorter("sortButton","masterSort2")},iFilterTheListOnUnitNumber:function(){return this.iMakeASelection("filterButton","masterFilterName","masterFilter1")},iGroupTheList:function(){return this.iChooseASorter("groupButton","masterGroup1")},iRemoveListGrouping:function(){return this.iChooseASorter("groupButton","VIEWSETTINGS_NONE_ITEM",true)},iOpenViewSettingsDialog:function(){return this.waitFor({id:"filterButton",actions:new t,errorMessage:"Did not find the 'filter' button."})},iPressOKInViewSelectionDialog:function(){return this.waitFor({searchOpenDialogs:true,controlType:"sap.m.Button",matchers:function(e){return this.I18NTextExtended(e,"VIEWSETTINGS_ACCEPT","text","sap.m")}.bind(this),actions:new t,errorMessage:"Did not find the ViewSettingDialog's 'OK' button."})},iPressResetInViewSelectionDialog:function(){return this.waitFor({searchOpenDialogs:true,controlType:"sap.m.Button",matchers:function(e){return this.I18NTextExtended(e,"VIEWSETTINGS_RESET","text","sap.m")}.bind(this),actions:new t,errorMessage:"Did not find the ViewSettingDialog's 'Reset' button."})},iMakeASelection:function(e,s,i){return this.waitFor({id:e,actions:new t,success:function(){this.waitFor({controlType:"sap.m.StandardListItem",matchers:function(e){return this.I18NTextExtended(e,s,"title")}.bind(this),searchOpenDialogs:true,actions:new t,success:function(){this.waitFor({controlType:"sap.m.StandardListItem",matchers:function(e){return this.I18NTextExtended(e,i,"title")}.bind(this),searchOpenDialogs:true,actions:new t,success:function(){this.waitFor({controlType:"sap.m.Button",matchers:function(e){return this.I18NTextExtended(e,"VIEWSETTINGS_ACCEPT","text","sap.m")}.bind(this),searchOpenDialogs:true,actions:new t,errorMessage:"The ok button in the dialog was not found and could not be pressed"})},errorMessage:"Did not find the"+i+"in"+s})},errorMessage:"Did not find the "+s+" element in select"})},errorMessage:"Did not find the "+e+" select"})},iRememberTheSelectedItem:function(){return this.waitFor({id:"list",matchers:function(e){return e.getSelectedItem()},success:function(e){this.iRememberTheListItem(e)},errorMessage:"The list does not have a selected item so nothing can be remembered"})},iChooseASorter:function(e,s,i){return this.waitFor({id:e,actions:new t,success:function(){this.waitFor({controlType:"sap.m.StandardListItem",matchers:new o({propertyName:"title",key:s,useLibraryBundle:i}),searchOpenDialogs:true,actions:new t,success:function(){this.waitFor({controlType:"sap.m.Button",matchers:new o({propertyName:"text",key:"VIEWSETTINGS_ACCEPT",useLibraryBundle:true}),searchOpenDialogs:true,actions:new t,errorMessage:"The ok button in the dialog was not found and could not be pressed"})},errorMessage:"Did not find the "+s+" element in select"})},errorMessage:"Did not find the "+e+" select"})},iRememberTheIdOfListItemAtPosition:function(e){return this.waitFor({id:"list",matchers:function(t){return t.getItems()[e]},success:function(e){this.iRememberTheListItem(e)},errorMessage:"The list does not have an item at the index "+e})},iRememberAnIdOfAnObjectThatsNotInTheList:function(){return this.waitFor({id:"list",matchers:new n({name:"items"}),success:function(e){var t=this.getEntitySet("Objects");var s;var i=t.filter(function(t){return!e.getItems().some(function(e){return e.getBindingContext().getProperty("ObjectID")===t.ObjectID})});if(!i.length){s=t[t.length-1].ObjectID}else{s=i[0].ObjectID}var r=this.getContext().currentItem;r.bindingPath="/"+e.getModel().createKey("Objects",{ObjectID:s});r.id=s}.bind(this),errorMessage:"the model does not have a item that is not in the list"})},iPressOnTheObjectAtPosition:function(e){return this.waitFor({id:"list",matchers:function(t){return t.getItems()[e]},actions:new t,errorMessage:"List 'list' in Master view does not contain an ObjectListItem at position '"+e+"'"})},iSearchFor:function(e){return this.waitFor({id:"searchField",actions:[new i({text:e}),new t],errorMessage:"Could not search for value "+e})},iSearchForNotFound:function(){return this.iSearchFor("*#-Q@@||")},iClearTheSearch:function(){return this.waitFor({id:"searchField",actions:new t({idSuffix:"reset"}),errorMessage:"Failed to clear the search in master list"})},iRememberTheListItem:function(e){var t=e.getBindingContext();this.getContext().currentItem={bindingPath:t.getPath(),id:t.getProperty("ObjectID"),title:t.getProperty("Name")}}},assertions:{theListShouldContainAGroupHeader:function(){return this.waitFor({controlType:"sap.m.GroupHeaderListItem",success:function(){e.assert.ok(true,"Master list is grouped")},errorMessage:"Master list is not grouped"})},theListShouldContainOnlyFormattedUnitNumbers:function(){var t=/^-?\d+\.\d{2}$/;return this.waitFor({controlType:"sap.m.ObjectListItem",success:function(s){e.assert.ok(s.every(function(e){return t.test(e.getNumber())}),"Numbers in ObjectListItems numbers are properly formatted")},errorMessage:"List has no entries which can be checked for their formatting"})},theListHeaderDisplaysZeroHits:function(){return this.waitFor({id:"masterPageTitle",autoWait:false,matchers:function(e){return this.I18NTextExtended(e,"<Objects> (0)","text")}.bind(this),success:function(){e.assert.ok(true,"The list header displays zero hits")},errorMessage:"The list header still has items"})},theListHasEntries:function(){return this.waitFor({id:"list",matchers:new n({name:"items"}),success:function(){e.assert.ok(true,"The list has items")},errorMessage:"The list had no items"})},theListShouldNotContainGroupHeaders:function(){function t(e){return e.getMetadata().getName()==="sap.m.GroupHeaderListItem"}return this.waitFor({id:"list",matchers:function(e){return!e.getItems().some(t)},success:function(){e.assert.ok(true,"Master list does not contain a group header although grouping has been removed.")},errorMessage:"Master list still contains a group header although grouping has been removed."})},theListShouldBeFilteredOnUnitNumber:function(){return this.theListShouldBeFilteredOnFieldUsingComparator("UnitNumber",100)},theListShouldBeSortedAscendingOnUnitNumber:function(){return this.theListShouldBeSortedAscendingOnField("UnitNumber")},theListShouldBeSortedAscendingOnName:function(){return this.theListShouldBeSortedAscendingOnField("Name")},theListShouldBeFilteredOnFieldUsingComparator:function(t,s){function i(e){var i=function(e){if(!e.getBindingContext()){return false}else{var i=e.getBindingContext().getProperty(t);if(i>s){return false}else{return true}}};return e.getItems().every(i)}return this.waitFor({id:"list",matchers:i,success:function(){e.assert.ok(true,"Master list has been filtered correctly for field '"+t+"'.")},errorMessage:"Master list has not been filtered correctly for field '"+t+"'."})},iShouldSeeTheList:function(){return this.waitFor({id:"list",success:function(t){e.assert.ok(t,"Found the object List")},errorMessage:"Can't see the master list."})},theListShowsOnlyObjectsContaining:function(t){this.waitFor({id:"list",matchers:new n({name:"items"}),check:function(e){var s=e.getItems().every(function(e){return e.getTitle().indexOf(t)!==-1});return s},success:function(){e.assert.ok(true,"Every item did contain the title "+t)},errorMessage:"The list had items with title different than "+t})},theListShouldHaveAllEntries:function(){var t;return this.waitFor({id:"list",matchers:function(e){var s=this.getEntitySet("Objects");t=Math.min(e.getGrowingThreshold(),s.length);return new r({name:"items",length:t}).isMatching(e)}.bind(this),success:function(s){e.assert.strictEqual(s.getItems().length,t,"The growing list displays all items")},errorMessage:"List does not display all entries."})},iShouldSeeTheNoDataText:function(){return this.waitFor({id:"list",success:function(t){e.assert.strictEqual(t.getNoDataText(),t.getModel("i18n").getProperty("masterListNoDataWithFilterOrSearchText"),"the list should show the no data text for search and filter")},errorMessage:"list does not show the no data text for search and filter"})},theHeaderShouldDisplayAllEntries:function(){return this.waitFor({id:"list",success:function(t){var s=t.getBinding("items").getLength();this.waitFor({id:"masterPageTitle",matchers:function(e){return this.I18NTextExtended(e,"masterTitleCount","text",null,[s])}.bind(this),success:function(){e.assert.ok(true,"The master page header displays "+s+" items")},errorMessage:"The  master page header does not display "+s+" items."})},errorMessage:"Header does not display the number of items in the list"})},theListShouldHaveNoSelection:function(){return this.waitFor({id:"list",matchers:function(e){return!e.getSelectedItem()},success:function(t){e.assert.strictEqual(t.getSelectedItems().length,0,"The list selection is removed")},errorMessage:"List selection was not removed"})},theRememberedListItemShouldBeSelected:function(){this.waitFor({id:"list",matchers:function(e){return e.getSelectedItem()},success:function(t){e.assert.strictEqual(t.getTitle(),this.getContext().currentItem.title,"The list selection is incorrect.\nHint: If the master list shows integer numbers, use toString function to convert the second parameter to string")},errorMessage:"The list has no selection"})},theListShouldBeSortedAscendingOnField:function(t){function s(e){var s=null,i=function(e){if(!e.getBindingContext()){return false}var i=e.getBindingContext().getProperty(t);if(i===undefined){return false}if(!s||i>=s){s=i}else{return false}return true};return e.getItems().every(i)}return this.waitFor({id:"list",matchers:s,success:function(){e.assert.ok(true,"Master list has been sorted correctly for field '"+t+"'.")},errorMessage:"Master list has not been sorted correctly for field '"+t+"'."})}}}})});