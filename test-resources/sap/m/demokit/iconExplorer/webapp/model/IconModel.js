sap.ui.define(["sap/ui/model/json/JSONModel","sap/ui/core/IconPool","sap/ui/demo/iconexplorer/model/Sorter","sap/base/Log"],function(t,e,o,n){"use strict";return t.extend("sap.ui.demo.iconexplorer.model.IconModel",{constructor:function(){t.apply(this,arguments);this.setSizeLimit(Infinity);return this},init:function(t){this._iStartTime=(new Date).getTime();this.setProperty("/AllIcons",[]);this.setProperty("/AllFonts",[]);this.setProperty("/AllFontsLoaded",[]);var e=[];for(var o=0;o<t.length;o++){e.push(this._loadIcons(t[o]))}this._pIconsLoaded=Promise.all(e);var n=this.getProperty("/AllFontsLoaded");n["BusinessSuiteInAppSymbols"]=false},iconsLoaded:function(){return this._pIconsLoaded},setFont:function(t){this._sFontName=t},getIconPath:function(t,e){var o=e||"/groups/0";o="/"+this._sFontName+o+"/icons";var n=this.getProperty(o),r;for(var s=0;s<n.length;s++){if(n[s].name===t){r=s;break}}if(r>=0){return o+"/"+r}else if(t!=="error"){return this.getIconPath("error",e)}},getGroupPath:function(t){var e="/"+this._sFontName+"/groups",o=this.getProperty(e),n=0;for(var r=0;r<o.length;r++){if(o[r].name===t){n=r;break}}return e+"/"+n},getIconGroups:function(t){var e="/"+this._sFontName+"/groups",o=this.getProperty(e),n=[];if(o){o=o.slice(1);n=o.filter(function(e){return e.icons.some(function(e){return e.name==t})})}return n.map(function(t){return t.text})},getUnicode:function(t){var o=this._sFontName==="SAP-icons"?undefined:this._sFontName,n=e.getIconInfo(t,o);return n?n.content:"?"},getUnicodeHTML:function(t){var o=this._sFontName==="SAP-icons"?undefined:this._sFontName,n=e.getIconInfo(t,o);return n&&n.content?"&#x"+n.content.charCodeAt(0).toString(16)+";":"?"},_loadIcons:function(e){var o=[];["groups.json","tags.json"].forEach(function(n){o.push(new Promise(function(o,r){var s=new t(sap.ui.require.toUrl("sap/ui/demo/iconexplorer/model/"+e+"/"+n));s.attachRequestCompleted(function(){o(this.getData())});s.attachRequestFailed(function(t){r(t)})}))});return Promise.all(o).then(function(t){this._onMetadataLoaded(e,t[0],t[1])}.bind(this),function(t){this._onError(t)}.bind(this))},_onMetadataLoaded:function(t,o,r){var s=this.getProperty("/AllFontsLoaded");if(t==="SAP-icons"||e.fontLoaded(t)){s[t]=true}else{s[t]=false}this.setProperty("/AllFontsLoaded",s);this._processGroups(o);this._processTags(t,r,o);var i=this.getProperty("/AllFonts");i.push({name:t});this.setProperty("/AllFonts",i);n.info("IconModel: Loaded and sorted all icons of "+t+" in "+((new Date).getTime()-this._iStartTime)+" ms");this.setProperty("/"+t,o)},_onError:function(t){t.error="Failed to load the icon metadata, check for parse errors";this.fireRequestFailed({response:t})},_processGroups:function(t){t.groups.sort(o.sortByName);t.groups.forEach(function(t){if(t.icons){t.count=t.icons.length;t.icons.sort(o.sortByName)}})},_processTags:function(t,n,r){var s=e.getIconNames(t==="SAP-icons"?undefined:t),i=t==="SAP-icons"?"":t+"/",a=["SAP-icons","SAP-icons-TNT"].indexOf(t)>=0?"OpenUI5":"SAPUI5";if(t==="SAP-icons-TNT"){s=s.filter(function(t){return t[0]!==t[0].toUpperCase()})}var c=s.map(function(e){var o=n[e],r=[];if(o){r=o.tags.map(function(t){return{name:t}})}return{name:e,iconPath:i,font:t,delivery:a,tags:r,tagString:o?o.tags.join(" "):""}});c.sort(o.sortByName);r.groups.splice(0,0,{name:"all",text:"All",icons:c,count:c.length});this.setProperty("/AllIcons",this.getProperty("/AllIcons").concat(c));this._calculateTagsPerGroup(r,t)},_calculateTagsPerGroup:function(t){for(var e=0;e<t.groups.length;e++){var o={};for(var r=0;r<t.groups[e].icons.length;r++){var s={};var i=this._getIconMetadata(t.groups[0],t.groups[e].icons[r]);if(i){t.groups[e].icons[r].tags=i.tags;t.groups[e].icons[r].tagString=i.tagString;s=i.tags}else{n.info("IconModel: Failed to load tags for "+t.groups[e].icons[r].name)}if(s){for(var a=0;a<s.length;a++){if(!o[s[a].name]){o[s[a].name]=1}else{o[s[a].name]++}}}}var c=this._sortGroupTags(o);t.groups[e].tags=[];for(var u=0;u<c.length;u++){t.groups[e].tags.push({name:c[u]})}}},_sortGroupTags:function(t){return Object.keys(t).sort(function(e,o){if(t[e]===t[o]){return 0}else if(t[e]<t[o]){return 1}else{return-1}})},_getIconMetadata:function(t,e){var o=t.icons;for(var n=0;n<o.length;n++){if(o[n].name===e.name){return o[n]}}}})});