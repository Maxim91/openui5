/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/thirdparty/jquery','sap/ui/Device','sap/ui/mdc/enum/EditMode','sap/ui/mdc/enum/FieldDisplay','sap/ui/mdc/enum/ConditionValidated','sap/ui/mdc/field/FieldBaseRenderer','sap/ui/mdc/condition/FilterOperatorUtil','sap/ui/mdc/condition/Condition','sap/ui/mdc/field/ConditionType','sap/ui/mdc/field/ConditionsType','sap/ui/mdc/enum/BaseType','sap/ui/mdc/field/content/ContentFactory','sap/ui/mdc/Control',"sap/ui/mdc/util/loadModules",'sap/ui/core/library','sap/ui/core/LabelEnablement','sap/ui/core/message/MessageMixin','sap/base/util/deepEqual','sap/base/util/merge','sap/base/Log','sap/ui/dom/containsOrEquals','sap/ui/model/BindingMode','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/ui/model/base/ManagedObjectModel','sap/ui/base/ManagedObjectObserver','sap/ui/base/SyncPromise','sap/base/util/restricted/_debounce','sap/ui/events/KeyCodes'],function(q,D,E,F,C,a,b,c,d,e,B,f,g,l,h,L,M,k,m,n,o,p,r,P,V,s,t,S,u,K){"use strict";var v=h.ValueState;var T=h.TextAlign;var w=h.TextDirection;var x=g.extend("sap.ui.mdc.field.FieldBase",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.ui.core.ISemanticFormContent"],designtime:"sap/ui/mdc/designtime/field/FieldBase.designtime",library:"sap.ui.mdc",properties:{dataType:{type:"string",group:"Data",defaultValue:'sap.ui.model.type.String'},dataTypeConstraints:{type:"object",group:"Data",defaultValue:null},dataTypeFormatOptions:{type:"object",group:"Data",defaultValue:null},editMode:{type:"sap.ui.mdc.enum.EditMode",group:"Data",defaultValue:E.Editable},required:{type:"boolean",group:"Data",defaultValue:false},display:{type:"sap.ui.mdc.enum.FieldDisplay",defaultValue:F.Value},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:T.Initial},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:w.Inherit},placeholder:{type:"string",group:"Misc",defaultValue:""},valueState:{type:"sap.ui.core.ValueState",group:"Appearance",defaultValue:v.None},valueStateText:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null},multipleLines:{type:"boolean",group:"Appearance",defaultValue:false},maxConditions:{type:"int",group:"Behavior",defaultValue:-1},conditions:{type:"object[]",group:"Data",defaultValue:[],byValue:true},label:{type:"string",group:"Misc",defaultValue:""},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/field/FieldBaseDelegate",payload:{}}},showEmptyIndicator:{type:"boolean",group:"Appearance",defaultValue:false},_fieldHelpEnabled:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"},_ariaAttributes:{type:"object",defaultValue:{},byValue:true,visibility:"hidden"}},aggregations:{content:{type:"sap.ui.core.Control",multiple:false},contentEdit:{type:"sap.ui.core.Control",multiple:false},contentDisplay:{type:"sap.ui.core.Control",multiple:false},_content:{type:"sap.ui.core.Control",multiple:true,visibility:"hidden"},fieldInfo:{type:"sap.ui.mdc.field.FieldInfoBase",multiple:false}},associations:{fieldHelp:{type:"sap.ui.mdc.ValueHelp",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{liveChange:{parameters:{value:{type:"string"},escPressed:{type:"boolean"},previousValue:{type:"string"}}},press:{},submit:{parameters:{promise:{type:"Promise"}}}},publicMethods:[],defaultAggregation:"content"},renderer:a,_oManagedObjectModel:null});M.call(x.prototype);var y={onsapprevious:e1,onsapnext:e1,onsapup:e1,onsapdown:e1,onsapbackspace:e1};var z={onsapenter:I};var A;x._init=function(){if(A&&A.bool&&A.bool.control){A.bool.control.destroy();}if(A&&A.defineConditions&&A.defineConditions.control){A.defineConditions.control.destroy();}A={bool:{modules:["sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Popover","sap/ui/mdc/valuehelp/content/Bool"],id:"BoolDefaultHelp",getDelegate:"getDefaultValueHelpDelegate",contentProperties:{},dialog:false,control:undefined,updateTitle:function(i,j){}},defineConditions:{modules:["sap/ui/mdc/ValueHelp","sap/ui/mdc/valuehelp/Dialog","sap/ui/mdc/valuehelp/content/Conditions"],id:"Field-DefineConditions-Help",getDelegate:"getDefaultValueHelpDelegate",contentProperties:{},dialog:true,control:undefined,updateTitle:function(i,j){i.getDialog().setTitle(j);i.getDialog().getContent()[0].setLabel(j);}}};};x._init();x.prototype.init=function(){g.prototype.init.apply(this,arguments);this._oObserver=new t(this._observeChanges.bind(this));this._oObserver.observe(this,{properties:["display","editMode","dataType","dataTypeFormatOptions","dataTypeConstraints","multipleLines","maxConditions","conditions","delegate"],aggregations:["fieldInfo","content","contentEdit","contentDisplay"],associations:["fieldHelp","ariaLabelledBy"]});this.attachEvent("modelContextChange",this._handleModelContextChange,this);this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._aAsyncChanges=[];this._bPreventGetDescription=false;this._oContentFactory=new f(this.getId()+"-contentFactory",{field:this,handleTokenUpdate:w1.bind(this),handleContentChange:q1.bind(this),handleContentLiveChange:t1.bind(this),handleValueHelpRequest:B1.bind(this),handleEnter:I.bind(this),handleContentPress:v1.bind(this)});this._oCreateContentPromise=undefined;this._sFilterValue="";};x.prototype.exit=function(){var i=this.getFieldInfo();if(i){i.detachEvent("dataUpdate",M1,this);}var j=this.getContent();if(j){$.call(this,j);}var T1=this.getContentEdit();if(T1){$.call(this,T1);}var U1=this.getContentDisplay();if(U1){$.call(this,U1);}if(this._oManagedObjectModel){this._oManagedObjectModel.destroy();delete this._oManagedObjectModel;}this._oObserver.disconnect();this._oObserver=undefined;this._oCreateContentPromise=undefined;var V1=z1.call(this);if(V1){V1.detachEvent("dataUpdate",G1,this);if(this._bConnected){I1.call(this,V1);V1.connect();}}if(this._oContentFactory){this._oContentFactory.destroy();this._oContentFactory=undefined;}u1.call(this);delete this._fnLiveChangeTimer;};x.prototype.applySettings=function(){g.prototype.applySettings.apply(this,arguments);if(!this.bDelegateInitialized&&!this.bDelegateLoading){this.initControlDelegate();}this._triggerCheckCreateInternalContent();this._bSettingsApplied=true;return this;};x.prototype.setProperty=function(i,j,T1){if(i==="editMode"){var U1=this.getEditMode();if(U1!==E.Display&&U1!==E.EditableDisplay&&j!==E.Display&&j!==E.EditableDisplay){T1=true;}}else if(i!=="width"&&i!=="multipleLines"&&i!=="showEmptyIndicator"){T1=true;}return g.prototype.setProperty.apply(this,[i,j,T1]);};x.prototype.onBeforeRendering=function(){a1.call(this);};x.prototype.onAfterRendering=function(){};x.prototype.onfocusin=function(i){J1.call(this);};x.prototype.onsapfocusleave=function(i){u1.call(this);};function _(i){var j=i.indexOf(this.getId());if(j>-1){if(this._bPendingChange){var T1=document.activeElement;var U1=z1.call(this);if(!(T1&&U1&&o(U1.getDomRef(),T1))){var V1=O1.call(this);if(V1){H.call(this,undefined,undefined,undefined,V1);}else{H.call(this,this.getConditions(),!this._bParseError);}}}if(i.length>1){i.splice(j,1);this.fireValidateFieldGroup({fieldGroupIds:i});}}}x.prototype.onsapup=function(i){if(this.getEditMode()===E.Editable){var j=z1.call(this);var T1=i.srcControl;if(j&&(!j.valueHelpEnabled||j.valueHelpEnabled()||j.isOpen())&&(!this._oContentFactory.isMeasure()||T1.getShowValueHelp())){i.preventDefault();i.stopPropagation();j.setFilterValue(this._sFilterValue);j.navigate(-1);}}};x.prototype.onsapdown=function(i){if(this.getEditMode()===E.Editable){var j=z1.call(this);var T1=i.srcControl;if(j&&(!j.valueHelpEnabled||j.valueHelpEnabled()||j.isOpen())&&(!this._oContentFactory.isMeasure()||T1.getShowValueHelp())){i.preventDefault();i.stopPropagation();j.setFilterValue(this._sFilterValue);j.navigate(1);}}};x.prototype.onsapenter=function(i){var j=z1.call(this);if(j&&j.isOpen(true)){j.close();}this._sFilterValue="";};x.prototype.onsapescape=function(i){this.onsapenter(i);};x.prototype.ontap=function(i){var j=z1.call(this);if(j){if(j.shouldOpenOnClick()&&!j.isOpen(true)){j.open(true);}var T1=i.srcControl;if(j.isOpen(true)&&(!this._oContentFactory.isMeasure()||(T1.getShowValueHelp&&T1.getShowValueHelp()))){T1.addStyleClass("sapMFocus");j.removeFocus();}}};x.prototype.clone=function(i,j){this.detachEvent("modelContextChange",this._handleModelContextChange,this);var T1=this.getContent();if(T1){$.call(this,T1);}var U1=this.getContentEdit();if(U1){$.call(this,U1);}var V1=this.getContentDisplay();if(V1){$.call(this,V1);}var W1=this.getFieldInfo();if(W1){W1.detachEvent("dataUpdate",M1,this);}var X1=g.prototype.clone.apply(this,arguments);this.attachEvent("modelContextChange",this._handleModelContextChange,this);if(T1){Z.call(this,T1);}if(U1){Z.call(this,U1);}if(V1){Z.call(this,V1);}if(W1){W1.attachEvent("dataUpdate",M1,this);}if(this._bTriggerable){X1._bTriggerable=this._bTriggerable;}return X1;};x.prototype.getFieldPath=function(){var i=this.getBindingPath("conditions");if(i&&i.startsWith("/conditions/")){return i.slice(12);}else{return"";}};function G(i,j,T1,U1){if(this._getContent().length>1){this._bPendingChange=true;}else{H.call(this,i,j,T1,U1);}}function H(i,j,T1,U1){if(!U1){if(j){U1=Promise.resolve(this._getResultForPromise(i));}else{U1=Promise.reject(T1);}}this._fireChange(i,j,T1,U1);this._bPendingChange=false;}x.prototype._fireChange=function(i,j,T1,U1){};function I(i){var j=this.getEditMode();if(f._getEditable(j)&&(this.hasListeners("submit")||this._bPendingChange)){var T1=O1.call(this);var U1=false;if(T1){U1=true;}else if(this._bParseError){T1=Promise.reject();}else{T1=Promise.resolve(this._getResultForPromise(this.getConditions()));}if(this._bPendingChange){if(U1){H.call(this,undefined,undefined,undefined,T1);}else{H.call(this,this.getConditions(),!this._bParseError,undefined,T1);}}this.fireSubmit({promise:T1});}}x.prototype._initDataType=function(){if(this._oContentFactory.getDataType()){this._oContentFactory.getDataType().destroy();this._oContentFactory.setDataType(undefined);}if(this._oContentFactory.getDateOriginalType()){if(this._oContentFactory.getDateOriginalType()._bCreatedByField){this._oContentFactory.getDateOriginalType().destroy();}this._oContentFactory.setDateOriginalType(undefined);}if(this._oContentFactory.getUnitOriginalType()){if(this._oContentFactory.getUnitOriginalType()._bCreatedByField){this._oContentFactory.getUnitOriginalType().destroy();}this._oContentFactory.getUnitOriginalType(undefined);}};function J(){if(this._oContentFactory.getDataType()&&typeof this._oContentFactory.getDataType()==="object"){return this._oContentFactory.getDataType().getMetadata().getName();}else if(this.bDelegateInitialized){return this.getControlDelegate().getDataTypeClass(this.getPayload(),this.getDataType());}else{return this.getDataType();}}function N(){var i=this._oContentFactory.getDataType();if(i&&typeof i==="object"&&i.getConstraints()){return i.getConstraints();}else{return this.getDataTypeConstraints();}}function O(){var i=this._oContentFactory.getDataType();if(i&&typeof i==="object"&&i.getFormatOptions()){return i.getFormatOptions();}else{return this.getDataTypeFormatOptions();}}x.prototype.getBaseType=function(){var i=J.call(this);var j=N.call(this);var T1=O.call(this);var U1=this.getTypeUtil().getBaseType(i,T1,j);return U1;};function Q(i,j){var T1=z1.call(this);if(T1&&this._bConnected){A1.call(this,i,T1);}}x.prototype._getContent=function(){var i=this.getContent();if(!i){if(this.getEditMode()===E.Display){i=this.getContentDisplay();}else{i=this.getContentEdit();}}if(i){return[i];}else{return this.getAggregation("_content",[]);}};x.prototype._handleModelContextChange=function(i){};function R(i){this.setValueState(v.Error);this.setValueStateText(i);}x.prototype._removeUIMessage=function(){this.setValueState(v.None);this.setValueStateText();};x.prototype._observeChanges=function(j){if(j.name==="dataType"){if(this._oContentFactory.getDataType()){var T1=function(W1){var X1=this.getTypeUtil().getDataTypeClass(j.current);if(!(this._oContentFactory.getDataType()instanceof X1)){this._initDataType();this.destroyAggregation("_content");this._oContentFactory.updateConditionType();}}.bind(this);if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){T1.call(this,j.current);}.bind(this));return;}T1.call(this,j.current);}}if(j.name==="dataTypeFormatOptions"||j.name==="dataTypeConstraints"){if(this._oContentFactory.getDataType()){this._initDataType();this.destroyAggregation("_content");this._oContentFactory.updateConditionType();}}if(j.name==="maxConditions"){this._updateInternalContent();}if(j.name==="conditions"){this._bParseError=false;Q.call(this,j.current,j.old);var U1=false;var i=0;for(i=0;i<this._aAsyncChanges.length;i++){var V1=this._aAsyncChanges[i];if(V1.waitForUpdate&&k(V1.result,j.current)){r1.call(this,V1);U1=true;break;}}if(U1){this._aAsyncChanges.splice(i,1);}if((j.current.length===0||j.old.length===0)&&this.getShowEmptyIndicator()&&this.getEditMode()===E.Display&&!this.getContent()&&!this.getContentDisplay()){this.invalidate();}}if(j.name==="display"){this._destroyInternalContent();this._oContentFactory.updateConditionType();}if(j.name==="fieldHelp"&&j.ids){x1.call(this,j.ids,j.mutation);this._oContentFactory.updateConditionType();}if(j.name==="fieldInfo"&&j.child){L1.call(this,j.child,j.mutation);}if(j.name==="content"&&j.child){Y.call(this,j.child,j.mutation,j.name);}if(j.name==="contentEdit"&&j.child){Y.call(this,j.child,j.mutation,j.name);}if(j.name==="contentDisplay"&&j.child){Y.call(this,j.child,j.mutation,j.name);}if(j.name==="delegate"&&!this.bDelegateInitialized&&!this.bDelegateLoading){this.initControlDelegate.call(this);}if(j.name==="ariaLabelledBy"&&j.ids){U.call(this,j.ids,j.mutation);}if(j.name==="editMode"){X.call(this);if(this._bSettingsApplied&&(j.old===E.Display||j.old===E.EditableDisplay||j.current===E.Display||j.current===E.EditableDisplay)){this._triggerCheckCreateInternalContent();}}};x.prototype._updateInternalContent=function(){if(this.getAggregation("_content",[]).length>0){a1.call(this);this._oContentFactory.updateConditionType();}};x.prototype.getFocusDomRef=function(){var i=this._getContent();if(i.length>0){return i[0].getFocusDomRef();}else{return this.getDomRef();}};x.prototype.getIdForLabel=function(){var i;var j=this._getContent();if(j.length>0){i=j[0].getIdForLabel();}else{i=c1.call(this);}return i;};x.prototype.getEditable=function(){return f._getEditable(this.getEditMode());};x.prototype.getControlForSuggestion=function(){var i=this._getContent();if(i.length>0){if(this._oContentFactory.isMeasure()){return i[1];}else{return i[0];}}else{return this;}};x.prototype.getFocusElementForValueHelp=function(j){var T1=this.getControlForSuggestion();var U1=T1&&T1.getMetadata().getAllPrivateAggregations()._endIcon&&T1.getAggregation("_endIcon",[]);var V1;for(var i=0;i<U1.length;i++){if(U1[i].getVisible()){V1=U1[i];break;}}return j||!V1?T1:V1;};x.prototype.getMaxConditionsForHelp=function(){if(this._oContentFactory.isMeasure()){return 1;}else{return this.getMaxConditions();}};x.prototype.getFormFormattedValue=function(){var i=this.getConditions();var j=this.getShowEmptyIndicator()&&i.length===0&&!this.getContent()&&!this.getContentDisplay();if(j){if(!this._oResourceBundleM){this._oResourceBundleM=sap.ui.getCore().getLibraryResourceBundle("sap.m");}return this._oResourceBundleM.getText("EMPTY_INDICATOR");}else if(this._oContentFactory.isMeasure()&&this._oContentFactory.getUnitOriginalType()){var T1=i.length>0?i[0].values[0]:[0,null];return this._oContentFactory.getUnitOriginalType().formatValue(T1,"string");}else if(this._oContentFactory.getDateOriginalType()){var U1=i.length>0?i[0].values[0]:null;return this._oContentFactory.getDateOriginalType().formatValue(U1,"string");}else{var V1=this._oContentFactory.getConditionsType();return V1.formatValue(i);}};x.prototype.getFormValueProperty=function(){return"conditions";};x.prototype.enhanceAccessibilityState=function(i,j){var T1=this.getParent();if(T1&&T1.enhanceAccessibilityState){T1.enhanceAccessibilityState(this,j);}};x.prototype.getAccessibilityInfo=function(){var i=this._getContent();if(i.length>0&&i[0].getAccessibilityInfo){return i[0].getAccessibilityInfo();}else{return{};}};function U(j,T1){var U1=this.getAggregation("_content",[]);var V1=this.getContent();if(V1){U1.push(V1);}V1=this.getContentDisplay();if(V1){U1.push(V1);}V1=this.getContentEdit();if(V1){U1.push(V1);}for(var i=0;i<U1.length;i++){V1=U1[i];if(V1.getMetadata().getAllAssociations().ariaLabelledBy){if(T1==="remove"){V1.removeAriaLabelledBy(j);}else if(T1==="insert"){V1.addAriaLabelledBy(j);}}}}function W(i,j){var T1={aria:{}};var U1=z1.call(this);if(U1){var V1=U1.getAriaAttributes(this.getMaxConditionsForHelp());var W1=V1.roleDescription;T1["role"]=V1.role;if(W1){T1.aria["roledescription"]=W1;}T1.aria["haspopup"]=V1.ariaHasPopup;T1["autocomplete"]="off";if(i){T1.aria["expanded"]="true";T1.aria["controls"]=V1.contentId;if(j){T1.aria["activedescendant"]=j;}}else{T1.aria["expanded"]="false";}T1["valueHelpEnabled"]=V1.valueHelpEnabled;}this.setProperty("_ariaAttributes",T1,true);}x.prototype.connectLabel=function(i){d1.call(this,i);i.bindProperty("text",{path:"$field>/label"});i.setLabelFor(this);return this;};function X(){var j=L.getReferencingLabels(this);for(var i=0;i<j.length;i++){var T1=sap.ui.getCore().byId(j[i]);T1.invalidate();}}function Y(i,j,T1){if(j==="remove"){$.call(this,i);g1.call(this,i);i1.call(this,i);if(this._oContentFactory.getContentConditionTypes()){delete this._oContentFactory.getContentConditionTypes()[T1];}i.setModel(null,"$field");}else if(j==="insert"){if(!i.isA("sap.ui.core.IFormContent")){throw new Error(i+" is not a valid content! Only use valid content in "+this);}f1.call(this,i,true);Z.call(this,i);h1.call(this,i,true);if(this.getAggregation("_content",[]).length>0){this._destroyInternalContent();}if(!this._oContentFactory.getContentConditionTypes()){this._oContentFactory.setContentConditionTypes({});}if(!this._oContentFactory.getContentConditionTypes()[T1]){this._oContentFactory.getContentConditionTypes()[T1]={};}var U1;var V1;for(V1 in i.getMetadata().getAllProperties()){if(i.getBindingPath(V1)==="/conditions"){U1=i.getBindingInfo(V1);if(U1&&U1.type&&U1.type instanceof e){this._oContentFactory.getContentConditionTypes()[T1].oConditionsType=U1.type;}this._oContentFactory.setBoundProperty(V1);}if(V1==="editable"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/editMode",formatter:f._getEditable});}if(V1==="enabled"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/editMode",formatter:f._getEnabled});}if(V1==="displayOnly"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/editMode",formatter:f._getDisplayOnly});}if(V1==="required"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/required"});}if(V1==="textAlign"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/textAlign"});}if(V1==="textDirection"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/textDirection"});}if(V1==="valueState"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/valueState"});}if(V1==="valueStateText"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/valueStateText"});}if(V1==="placeholder"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/placeholder"});}if(V1==="showValueHelp"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.bindProperty(V1,{path:"$field>/_fieldHelpEnabled"});}if(V1==="valueHelpIconSrc"&&!i.getBindingPath(V1)&&i.isPropertyInitial(V1)){i.setValueHelpIconSrc(this._getFieldHelpIcon());}}for(var W1 in i.getMetadata().getAllAggregations()){if(i.getBindingPath(W1)==="/conditions"){U1=i.getBindingInfo(W1);if(U1&&U1.template){for(V1 in U1.template.getMetadata().getAllProperties()){var X1=U1.template.getBindingInfo(V1);if(X1&&X1.type&&X1.type instanceof d){this._oContentFactory.getContentConditionTypes()[T1].oConditionType=X1.type;break;}}}}if(W1==="tooltip"&&!i.getBindingPath(W1)&&!i.getAggregation(W1)){i.bindProperty(W1,{path:"$field>/tooltip"});}}if(i.getMetadata().getAllAssociations().ariaLabelledBy){this._oContentFactory.setAriaLabelledBy(i);}}}function Z(i){if(i.getMetadata().getEvents().change){i.attachEvent("change",q1,this);}if(i.getMetadata().getEvents().liveChange){i.attachEvent("liveChange",t1,this);}if(i.getMetadata().getEvents().press){i.attachEvent("press",v1,this);}if(i.getMetadata().getEvents().valueHelpRequest){i.attachEvent("valueHelpRequest",B1,this);}}function $(i){if(i.getMetadata().getEvents().change){i.detachEvent("change",q1,this);}if(i.getMetadata().getEvents().liveChange){i.detachEvent("liveChange",t1,this);}if(i.getMetadata().getEvents().press){i.detachEvent("press",v1,this);}if(i.getMetadata().getEvents().valueHelpRequest){i.detachEvent("valueHelpRequest",B1,this);}}function a1(){var i=function(){if(!this.bDelegateInitialized){this.awaitControlDelegate().then(function(){a1.call(this);}.bind(this));}else{b1.call(this);}};if(this._oCreateContentPromise){this._oCreateContentPromise.then(function(){a1.call(this);}.bind(this));}else{i.call(this);}}x.prototype._checkCreateInternalContent=function(){if(!this.bIsDestroyed&&this.getVisible()&&this._oContentFactory.getDataType()){a1.call(this);}};x.prototype._triggerCheckCreateInternalContent=function(){if(!this._oCheckCreateInternalContentPromise){this._oCheckCreateInternalContentPromise=this.awaitControlDelegate().then(function(){delete this._oCheckCreateInternalContentPromise;this._checkCreateInternalContent();}.bind(this));}};function b1(){var i=this.getEditMode();var j=this.getContent();this._oContentFactory._setUsedConditionType(j,i);y1.call(this,this.getFieldHelp());W.call(this,false);if(j||this._bIsBeingDestroyed||(i===E.Display&&this.getContentDisplay())||(i!==E.Display&&this.getContentEdit())){this._destroyInternalContent();var T1=this._getContent();if(T1.length===1){d1.call(this,T1[0]);}return;}var U1=this.getMaxConditions();var V1=this._getOperators();var W1;var X1=this.getAggregation("_content",[]);var Y1;var Z1;var $1=this.getMultipleLines();var _1=this._bTriggerable;var a2=this._oContentFactory.getContentType(this.getBaseType(),this.getMaxConditions(),_1);if(X1.length>0){Y1=X1[0];Z1=Y1.getMetadata().getName().replace(/\./g,"/");}var b2=this._oContentFactory.getContentMode(a2,i,U1,$1,V1);var c2=a2.getControlNames(b2,V1[0]);W1=c2[0];if(W1!==Z1){this._oContentFactory.setHideOperator(m1.call(this,V1));if(Y1){this._destroyInternalContent();if(Y1.isA("sap.m.DateTimeField")){this._initDataType();}this._oContentFactory.updateConditionType();}if(l1.call(this,a2,V1,i,U1)){j1.call(this,a2.getUseDefaultFieldHelp().name);}else if(this._sDefaultFieldHelp){delete this._sDefaultFieldHelp;}var d2=c1.call(this);this._oCreateContentPromise=this._oContentFactory.createContent(a2,b2,d2);this._oCreateContentPromise.then(function(e2){for(var f2=0;f2<e2.length;f2++){var g2=e2[f2];g2.attachEvent("parseError",n1,this);g2.attachEvent("validationError",o1,this);g2.attachEvent("validationSuccess",p1,this);f1.call(this,g2,a2.getUseDefaultEnterHandler());h1.call(this,g2,false);d1.call(this,g2);if(this._bConnected&&((f2===0&&!this._oContentFactory.isMeasure())||(f2===1&&this._oContentFactory.isMeasure()))){K1.call(this,g2);}this.addAggregation("_content",g2);}X.call(this);delete this._oCreateContentPromise;}.bind(this));}}function c1(){return this.getId()+"-inner";}x.prototype._destroyInternalContent=function(){this.destroyAggregation("_content");if(this._oContentFactory.getDateOriginalType()){this._oContentFactory.setDataType(this._oContentFactory.getDateOriginalType());this._oContentFactory.setDateOriginalType(undefined);}else if(this._oContentFactory.getUnitOriginalType()){this._oContentFactory.setDataType(this._oContentFactory.getUnitOriginalType());this._oContentFactory.setUnitOriginalType(undefined);}if(this._bParseError){this._bParseError=false;this._removeUIMessage();}if(this._oContentFactory.isMeasure()){this._oContentFactory.setIsMeasure(false);}};function d1(i){if(!this._oManagedObjectModel&&!this._bIsBeingDestroyed){this._oManagedObjectModel=new s(this);}i.setModel(this._oManagedObjectModel,"$field");}function e1(i){var j=false;var T1=z1.call(this);if(!T1){return;}else if(T1.isOpen()){j=true;}else{switch(i.type){case"sapprevious":case"sapup":if(i.keyCode===K.ARROW_UP){j=true;}break;case"sapnext":case"sapdown":if(i.keyCode===K.ARROW_DOWN){j=true;}break;default:break;}}if(j){i.stopPropagation();i.stopImmediatePropagation(true);switch(i.type){case"sapup":this.onsapup(i);break;case"sapdown":this.onsapdown(i);break;default:break;}}}function f1(i,j){i.addDelegate(y,true,this);if(j){i.addDelegate(z,false,this);}}function g1(i){i.removeDelegate(y);i.removeDelegate(z);}function h1(i,j){if(j){i._OriginalGetFieldGroupIds=i._getFieldGroupIds;i._OriginalTriggerValidateFieldGroup=i.triggerValidateFieldGroup;}i._getFieldGroupIds=function(){var T1=this.getFieldGroupIds();var U1=this.getParent();if(U1){T1=T1.concat(U1._getFieldGroupIds());}return T1;};i.triggerValidateFieldGroup=function(T1){var U1=this.getParent();if(U1){var V1=T1.indexOf(U1.getId());if(V1>-1){_.call(U1,T1);}else{U1.fireValidateFieldGroup({fieldGroupIds:T1});}}};}function i1(i){if(i._OriginalGetFieldGroupIds&&i._OriginalTriggerValidateFieldGroup){i._getFieldGroupIds=i._OriginalGetFieldGroupIds;delete i._OriginalGetFieldGroupIds;i.triggerValidateFieldGroup=i._OriginalTriggerValidateFieldGroup;delete i._OriginalTriggerValidateFieldGroup;}}function j1(i){this._sDefaultFieldHelp=A[i].id;var j=A[i].control;if(j&&j.bIsDestroyed){A[i].control=undefined;j=undefined;}if(!j){if(A[i].promise){A[i].promise.then(k1.bind(this,A[i].id));}else{A[i].promise=l(A[i].modules).catch(function(T1){throw new Error("loadModules promise rejected in sap.ui.mdc.field.FieldBase:_createDefaultFieldHelp function call - could not load controls "+JSON.stringify(A[i].modules));}).then(function(T1){var U1=T1[0];var V1=T1[1];var W1=T1[2];var X1=this.bDelegateInitialized&&this.getControlDelegate()[A[i].getDelegate]();j=new U1(A[i].id,{delegate:X1});var Y1=new V1(A[i].id+"-container",{content:[new W1(A[i].id+"-content",A[i].contentProperties)]});j._bIsDefaultHelp=true;j._sDefaultHelpType=i;A[i].control=j;if(A[i].dialog){j.setDialog(Y1);}else{j.setTypeahead(Y1);}j.connect(this);k1.call(this,A[i].id);}.bind(this)).unwrap();}}else{k1.call(this,A[i].id);}W.call(this,false);}function k1(i){x1.call(this,i,"insert");}function l1(i,j,T1,U1){var V1=i.getUseDefaultFieldHelp();if(V1&&!this.getFieldHelp()&&T1!==E.Display){if((U1===1&&V1.single)||(U1!==1&&V1.multi)){if(j.length===1){var W1=m1.call(this,j);if(U1===1){if(!(i.getEditOperator()&&i.getEditOperator()[j[0]])&&(V1.oneOperatorSingle||!W1)){return true;}}else if(V1.oneOperatorMulti||!W1){return true;}}else{return true;}}}return false;}function m1(i){if(i.length===1){var j=b.getOperator(i[0]);return!j||j.isSingleValue();}else{return false;}}function n1(i){this._bParseError=true;this._sFilterValue="";}function o1(T1){this._bParseError=true;this._sFilterValue="";var U1=T1.getParameter("newValue");var V1=false;var i=0;for(i=0;i<this._aAsyncChanges.length;i++){var W1=this._aAsyncChanges[i];if(W1.waitForUpdate&&Array.isArray(W1.result)){if(W1.result.length===0&&U1===""){W1.reject(T1.getParameter("exception"));V1=true;}else{for(var j=0;j<W1.result.length;j++){var X1=W1.result[j];if(k(X1.values[0],U1)||(X1.operator==="BT"&&k(X1.values[1],U1))){W1.reject(T1.getParameter("exception"));V1=true;break;}}}if(V1){break;}}}if(V1){this._aAsyncChanges.splice(i,1);}}function p1(i){this._bParseError=false;}function q1(i){var j={parameters:m({},i.getParameters()),source:i.getSource()};var T1=this._aAsyncChanges.length;if(T1>0&&!this._aAsyncChanges[T1-1].changeFired){this._aAsyncChanges[T1-1].changeFired=true;this._aAsyncChanges[T1-1].changeEvent=j;G.call(this,undefined,undefined,undefined,this._aAsyncChanges[T1-1].promise);return;}var U1={changeEvent:j};r1.call(this,U1);}function r1(i){var j=this.getConditions();var T1;var U1=true;var V1;var W1;var X1=i.changeEvent.source;var Y1=false;var Z1=true;var $1=false;if(i.changeEvent.parameters.hasOwnProperty("valid")){U1=i.changeEvent.parameters["valid"];if(!U1&&i.changeEvent.parameters.hasOwnProperty("value")){V1=i.changeEvent.parameters["value"];}}var _1=false;var a2=this._oContentFactory.getBoundProperty();var b2=a2&&X1.getBinding(a2);if(b2&&b2.getBindingMode()!==p.OneWay&&b2.getPath()==="/conditions"&&U1){W1=j[0];T1=j[0]&&j[0].values[0];}else if(i.changeEvent.parameters.hasOwnProperty("value")){T1=i.changeEvent.parameters["value"];if(U1){_1=true;}}else{W1=j[0];T1=j[0]&&j[0].values[0];}if(_1){this._removeUIMessage();var c2;var d2;if(this._bIgnoreInputValue){this._bIgnoreInputValue=false;X1.setDOMValue("");if(X1.getMetadata().hasProperty("value")){X1.setValue();}return;}W1=S.resolve().then(function(){var f2=this.getMaxConditions();if(this._oNavigateCondition){U1=true;return this._oNavigateCondition;}else if(T1===""&&f2!==1){return null;}else{c2=this._oContentFactory.getConditionType();var g2=c2.parseValue(T1);var h2=this._aAsyncChanges.length;if(h2>0&&!this._aAsyncChanges[h2-1].changeFired){d2=this._aAsyncChanges[h2-1];d2.changeFired=true;d2.changeEvent=i.changeEvent;G.call(this,undefined,undefined,undefined,d2.promise);}return g2;}}.bind(this)).then(function(W1){Z1=s1.call(this,W1,j,c2,U1,T1,X1,d2||i);Z1=Z1||$1;return W1;}.bind(this)).catch(function(f2){if(f2&&!(f2 instanceof P)&&!(f2 instanceof r)&&!(f2 instanceof V)){throw f2;}U1=false;V1=T1;this._bParseError=true;this._sFilterValue="";R.call(this,f2.message);if(d2&&d2.reject){if(Q1.call(this,d2)){d2.reject(f2);}}else if(Y1){G.call(this,j,U1,V1);}}.bind(this)).unwrap();if(W1 instanceof Promise){Y1=true;}}else if(!i.changeEvent.parameters.hasOwnProperty("valid")&&this._bParseError){V1=i.changeEvent.parameters["value"];U1=false;}var e2=z1.call(this);if(e2&&this._bConnected){if(sap.ui.getCore().getCurrentFocusedControlId()===X1.getId()){e2.close();}this._sFilterValue="";if(!Y1&&U1){A1.call(this,j,e2);e2.onControlChange();}u1.call(this);}if(this._oNavigateCondition){this._oNavigateCondition=undefined;this._oContentFactory.updateConditionType();}if(i.resolve){P1.call(this,i);}else if(!Y1&&Z1){G.call(this,j,U1,V1);}}function s1(i,j,T1,U1,V1,W1,X1){var Y1=this.getMaxConditions();var Z1=false;if(i===null&&Y1!==1){return true;}if(T1){T1.validateValue(i);}if(U1){if(i){if(this._oContentFactory.isMeasure()&&j.length===1&&j[0].values[0][0]===undefined){j=[];}if(Y1!==1&&b.indexOfCondition(i,j)>=0){throw new P(this._oResourceBundle.getText("field.CONDITION_ALREADY_EXIST",[V1]));}else{if(Y1>0&&Y1<=j.length){j.splice(0,j.length-Y1+1);}j.push(i);}}else if(Y1===1){j=[];}if(!k(j,this.getConditions())){this.setProperty("conditions",j,true);Z1=true;}if(Y1!==1){W1.setValue("");}}if(X1.resolve){var $1=z1.call(this);if($1&&this._bConnected){A1.call(this,j,$1);$1.onControlChange();}X1.result=j;P1.call(this,X1);Q1.call(this,X1);}return Z1;}function t1(j){var T1;var U1;var V1=false;var W1=j.getSource();this._oNavigateCondition=undefined;this._oContentFactory.updateConditionType();if("value"in j.getParameters()){T1=j.getParameter("value");}else if("newValue"in j.getParameters()){T1=j.getParameter("newValue");}if("escPressed"in j.getParameters()){V1=j.getParameter("escPressed");}if("previousValue"in j.getParameters()){U1=j.getParameter("previousValue");}else{var X1=this.getConditions();U1=X1[0]&&X1[0].values[0];}var Y1=z1.call(this);if(Y1&&(!this._oContentFactory.isMeasure()||W1.getShowValueHelp())){if(V1){if(Y1.isOpen(true)){Y1.close();A1.call(this,this.getConditions(),Y1);u1.call(this);this._sFilterValue="";}}else{var Z1=this._getOperators();var $1=false;for(var i=0;i<Z1.length;i++){var _1=b.getOperator(Z1[i]);if(_1.validateInput){$1=true;break;}}if($1){this._bIgnoreInputValue=false;this._vLiveChangeValue=T1;if(!this._fnLiveChangeTimer){this._fnLiveChangeTimer=u(function(){var b2=this.getDisplay();this._sFilterValue="";if(this._vLiveChangeValue){var _1=b.getEQOperator();var c2=_1.getValues(this._vLiveChangeValue,b2,true);if(c2[0]){this._sFilterValue=c2[0];if(c2[1]){this._sFilterValue=this._sFilterValue+" ";}}if(c2[1]){this._sFilterValue=this._sFilterValue+c2[1];}}var a2=this.hasOwnProperty("_bOpenByTyping")?this._bOpenByTyping:Y1.isTypeaheadSupported();if(this._bConnected&&this._getContent()[0]&&a2&&(sap.ui.getCore().getCurrentFocusedControlId()===this._getContent()[0].getId()||(this._getContent()[1]&&sap.ui.getCore().getCurrentFocusedControlId()===this._getContent()[1].getId()))){Y1.setFilterValue(this._sFilterValue);if(this.getMaxConditionsForHelp()===1&&Y1.getConditions().length>0){Y1.setConditions([]);}Y1.open(true);W.call(this,true);delete this._vLiveChangeValue;}}.bind(this),300,{leading:false,trailing:true});Y1.initBeforeOpen(true);}var a2=Y1.isTypeaheadSupported();if(a2 instanceof Promise){a2.then(function(b2){var c2=document.activeElement;if(c2&&(o(this.getDomRef(),c2))&&this._fnLiveChangeTimer){this._fnLiveChangeTimer();}this._bOpenByTyping=b2;}.bind(this));}this._fnLiveChangeTimer();}}}this.fireLiveChange({value:T1,escPressed:V1,previousValue:U1});}function u1(){if(this._fnLiveChangeTimer){this._fnLiveChangeTimer.cancel();delete this._vLiveChangeValue;}}function v1(i){var j=this.getFieldInfo();if(j){j.getTriggerHref().then(function(T1){if(!T1){j.open(this._getContent()[0]);W.call(this,true);}}.bind(this));}this.firePress();}function w1(j){if(j.getParameter("type")==="removed"){var T1=j.getParameter("removedTokens");var U1=this.getConditions();var V1;var i;for(i=0;i<T1.length;i++){var W1=T1[i];var X1=W1.getBindingContext("$field").sPath;var Y1=parseInt(X1.slice(X1.lastIndexOf("/")+1));U1[Y1].delete=true;}for(i=U1.length-1;i>=0;i--){if(U1[i].delete){if(this._oContentFactory.isMeasure()){V1=U1[i].values[0][1];}U1.splice(i,1);}}if(this._oContentFactory.isMeasure()&&V1&&U1.length===0){U1=[c.createItemCondition([undefined,V1],undefined)];}this.setProperty("conditions",U1,true);H.call(this,U1,true);j.preventDefault(true);}}function x1(i,j){var T1;if(j==="remove"){T1=sap.ui.getCore().byId(i);if(T1){I1.call(this,T1);T1.detachEvent("dataUpdate",G1,this);}this.resetProperty("_fieldHelpEnabled");}else if(j==="insert"){if(this._sDefaultFieldHelp&&i!==this._sDefaultFieldHelp){x1.call(this,this._sDefaultFieldHelp,"remove");delete this._sDefaultFieldHelp;}y1.call(this,i);var U1=this._getContent()[0];if(U1&&U1.setValueHelpIconSrc){U1.setValueHelpIconSrc(this._getFieldHelpIcon());}}Q.call(this,this.getConditions());}function y1(i){if(i&&this.isPropertyInitial("_fieldHelpEnabled")){var j=sap.ui.getCore().byId(i);if(j){j.attachEvent("dataUpdate",G1,this);if(!j.valueHelpEnabled||j.valueHelpEnabled()){this.setProperty("_fieldHelpEnabled",true,true);}}}}function z1(){var i=this.getFieldHelp();var j;if(!i&&this._sDefaultFieldHelp){i=this._sDefaultFieldHelp;}if(i){j=sap.ui.getCore().byId(i);}return j;}function A1(j,T1){if(!T1){T1=z1.call(this);}if(this._oContentFactory.isMeasure()){var U1=[];for(var i=0;i<j.length;i++){var V1=j[i];if(V1.values[0]&&V1.values[0][1]){var W1=c.createItemCondition(V1.values[0][1],undefined,V1.inParameters,V1.outParameters);U1.push(W1);}}T1.setConditions(U1);}else{T1.setConditions(j);}}function B1(i){var j=z1.call(this);if(j){j.setFilterValue(this._sFilterValue);var T1=this.getConditions();A1.call(this,T1,j);j.toggleOpen(false);W.call(this,true);if(!j.isFocusInHelp()){var U1=i.getSource();if(U1.bValueHelpRequested){U1.bValueHelpRequested=false;}}}}function C1(j){var T1=this.getConditions();var U1=j.getParameter("conditions");var V1=j.getParameter("add");var W1=j.getParameter("close");var X1=j.oSource;var Y1=this.getMaxConditions();var Z1;var $1=this.getControlForSuggestion();var _1;var i=0;if(this._oContentFactory.isMeasure()){if(U1.length>1){throw new Error("Only one item must be selected! "+this);}if(U1[0].operator!=="EQ"){throw new Error("Only EQ allowed! "+this);}if(T1.length>0){for(i=0;i<T1.length;i++){T1[i].values[0][1]=U1[0].values[0];if(T1[i].operator==="BT"){T1[i].values[1][1]=U1[0].values[0];}if(U1[0].inParameters){T1[i].inParameters=U1[0].inParameters;}if(U1[0].outParameters){T1[i].outParameters=U1[0].outParameters;}if(U1[0].payload){T1[i].payload=U1[0].payload;}}}else{var a2=b.getEQOperator(this._getOperators());var b2=this.getControlDelegate().enhanceValueForUnit(this.getPayload(),[null,U1[0].values[0]],this._oTypeInitialization);Z1=c.createCondition(a2.name,[b2],U1[0].inParameters,U1[0].outParameters,C.NotValidated);T1.push(Z1);var c2=this._oContentFactory.getConditionType(true);var d2=this._oContentFactory.getUnitConditionsType(true);if(c2){_1=c2.formatValue(Z1);}else if(d2){_1=d2.formatValue(T1);}}}else{if(!V1){T1=[];}for(i=0;i<U1.length;i++){Z1=U1[i];if(!R1.call(this,Z1.operator)){continue;}var e2=b.indexOfCondition(Z1,T1);if(e2===-1){T1.push(Z1);}else if(Z1.validated===C.Validated&&Z1.values.length>1&&(T1[e2].values.length===1||Z1.values[1]!==T1[e2].values[1])){T1[e2].values=Z1.values;}}}if(Y1>0&&Y1<T1.length){T1.splice(0,T1.length-Y1);}var f2=false;if($1&&$1.setDOMValue){if(this.getMaxConditionsForHelp()===1&&T1.length>0){if(this._oContentFactory.isMeasure()&&this._oContentFactory.getUnitConditionsType()){_1=this._oContentFactory.getUnitConditionsType().formatValue(T1);}else if(this._oContentFactory.getConditionType(true)){_1=this._oContentFactory.getConditionType().formatValue(T1[0]);}else if(this._oContentFactory.getConditionsType(true)){_1=this._oContentFactory.getConditionsType().formatValue(T1);}if(_1 instanceof Promise){_1.then(function(h2){$1.setDOMValue("");$1.setDOMValue(h2);});}else{$1.setDOMValue("");$1.setDOMValue(_1);}this._sFilterValue="";}else if(W1){if(this.getMaxConditions()!==1&&!this._oContentFactory.getBoundProperty()&&$1.getMetadata().hasProperty("value")&&$1.getProperty("value")){$1.setValue();}$1.setDOMValue("");this._sFilterValue="";this._bIgnoreInputValue=false;}else{this._bIgnoreInputValue=true;}if(this._bParseError){this._bParseError=false;this._removeUIMessage();f2=true;}}var g2=this.getConditions();if(!k(T1,g2)){this._oNavigateCondition=undefined;this._oContentFactory.updateConditionType();this.setProperty("conditions",T1,true);if(!b.compareConditionsArray(T1,g2)){X1.onControlChange();G.call(this,T1,true);}}else if(f2){G.call(this,T1,true);}}function D1(i){var j=i.getParameter("value");var T1=i.getParameter("key");var U1=i.getParameter("condition");var V1=i.getParameter("itemId");var W1=i.getParameter("leaveFocus");if(!U1&&T1){U1=c.createItemCondition(T1,j);}var X1;var Y1;var Z1=this.getControlForSuggestion();var $1=b.getEQOperator(this._getOperators());var _1=z1.call(this);if(W1){Z1.addStyleClass("sapMFocus");Z1.focus();_1.removeFocus();return;}if(U1){this._oNavigateCondition=m({},U1);this._oNavigateCondition.operator=$1.name;T1=U1.values[0];j=U1.values[1];}else{this._oNavigateCondition=c.createCondition($1.name,[T1,j],undefined,undefined,C.Validated);}if(this._oContentFactory.isMeasure()){var a2=this.getConditions();if(a2.length>0){this._oNavigateCondition.operator=a2[0].operator;this._oNavigateCondition.values[0]=[a2[0].values[0][0],T1];if(a2[0].operator==="BT"){this._oNavigateCondition.values[1]=[a2[0].values[1][0],this._oNavigateCondition.values[0][1]];}else if(this._oNavigateCondition.values.length>1){this._oNavigateCondition.values.splice(1);}}else{this._oNavigateCondition.values=[this.getControlDelegate().enhanceValueForUnit(this.getPayload(),[null,T1],this._oTypeInitialization)];}}this._bPreventGetDescription=true;this._oContentFactory.updateConditionType();if(this.getDisplay()!==F.Value){X1=T1;}else if(j){X1=j;}else{X1=T1;}if(Z1&&Z1.setDOMValue){if(!Y1){if(this._oContentFactory.isMeasure()&&this._oContentFactory.getUnitConditionsType()&&this._oNavigateCondition){Y1=this._oContentFactory.getUnitConditionsType().formatValue([this._oNavigateCondition]);}else if(this._oContentFactory.getConditionType(true)&&this._oNavigateCondition){Y1=this._oContentFactory.getConditionType().formatValue(this._oNavigateCondition);}else if(this._oContentFactory.getConditionsType(true)&&this._oNavigateCondition){Y1=this._oContentFactory.getConditionsType().formatValue([this._oNavigateCondition]);}else{Y1=j||T1;}}Z1.setDOMValue(Y1);Z1._doSelect();if(_1.isOpen()){Z1.removeStyleClass("sapMFocus");}}this._bPreventGetDescription=false;this._oContentFactory.updateConditionType();W.call(this,true,V1);this._bIgnoreInputValue=false;this.fireLiveChange({value:X1});}function E1(i){if(this._bIgnoreInputValue){var j=this.getControlForSuggestion();this._bIgnoreInputValue=false;j.setDOMValue("");this._sFilterValue="";if(this.getMaxConditions()!==1&&!this._oContentFactory.getBoundProperty()&&j.getMetadata().hasProperty("value")&&j.getProperty("value")){j.setValue();}}W.call(this,false);var T1=i.getSource();var U1=this.getConditions();A1.call(this,U1,T1);}function F1(i){var j=this.getControlForSuggestion();j.focus();if(j.fireValueHelpRequest){j.bValueHelpRequested=true;j.fireValueHelpRequest();}}function G1(i){var j=this.getEditMode()===E.Editable&&this._getContent().length>0&&sap.ui.getCore().getCurrentFocusedControlId()===this._getContent()[0].getId();if(!j&&!this._bPendingConditionUpdate&&this.getConditions().length>0&&(this.getMaxConditions()!==1||(this.getDisplay()!==F.Value&&!this._bParseError))&&this._oManagedObjectModel){this._oManagedObjectModel.checkUpdate(true);}}function H1(i){var j=z1.call(this);I1.call(this,j);}function I1(i){if(this._bConnected){i.detachEvent("select",C1,this);i.detachEvent("navigated",D1,this);i.detachEvent("disconnect",H1,this);i.detachEvent("afterClose",E1,this);i.detachEvent("switchToValueHelp",F1,this);i.detachEvent("closed",E1,this);this._bConnected=false;}}function J1(){var i=z1.call(this);if(i&&!this._bConnected){var j=S1.call(this);var T1;var U1=this._oContentFactory.isMeasure();if(U1){var V1=this._oContentFactory.getCompositeTypes();if(V1&&V1.length>1){T1=V1[1];}}else{T1=this._oContentFactory.getDataType();}var W1={maxConditions:this.getMaxConditions(),dataType:T1,operators:this._getOperators(),display:U1?F.Value:this.getDisplay(),delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),conditionModel:j.model,conditionModelName:j.name,defaultOperatorName:this.getDefaultOperator?this.getDefaultOperator():null};i.connect(this,W1);this._bConnected=true;i.attachEvent("select",C1,this);i.attachEvent("navigated",D1,this);i.attachEvent("disconnect",H1,this);i.attachEvent("afterClose",E1,this);i.attachEvent("switchToValueHelp",F1,this);i.attachEvent("closed",E1,this);var X1=this.getConditions();A1.call(this,X1,i);var Y1=this.getControlForSuggestion();K1.call(this,Y1);if(i._bIsDefaultHelp){A[i._sDefaultHelpType].updateTitle(i,this.getLabel());}}}function K1(i){if(i&&!i.orgOnsapfocusleave&&i.onsapfocusleave){i.orgOnsapfocusleave=i.onsapfocusleave;i.onsapfocusleave=function(j){var T1=z1.call(this.getParent());if(T1){var U1=sap.ui.getCore().byId(j.relatedControlId);if(U1){if(o(T1.getDomRef(),U1.getFocusDomRef())){j.stopPropagation();return;}else{T1.skipOpening();}}}this.orgOnsapfocusleave(j);};}}x.prototype._getFieldHelpIcon=function(){var i=z1.call(this);if(i){return i.getIcon();}};function L1(i,j){if(j==="remove"){i.detachEvent("dataUpdate",M1,this);}else if(j==="insert"){i.attachEvent("dataUpdate",M1,this);M1.call(this);}}function M1(){var i=this.getFieldInfo();var j=this;i.isTriggerable().then(function(T1){j._bTriggerable=T1;var U1=j.getAggregation("_content",[]);if(U1.length>0&&j.getEditMode()===E.Display){a1.call(j);if(j._bTriggerable){U1=j.getAggregation("_content",[]);var V1=U1[0];i.getDirectLinkHrefAndTarget().then(function(W1){f._updateLink(V1,W1);});}}});}x.prototype._getFormatOptions=function(){if(!this._asyncParsingCall){this._asyncParsingCall=N1.bind(this);}var i=S1.call(this);return{valueType:this._oContentFactory.retrieveDataType(),originalDateType:this._oContentFactory.getDateOriginalType()||this._oContentFactory.getUnitOriginalType(),additionalType:this._oContentFactory.getUnitType(),compositeTypes:this._oContentFactory.getCompositeTypes(),display:this._oContentFactory.isMeasure()?F.Value:this.getDisplay(),fieldHelpID:this._oContentFactory.isMeasure()?undefined:this.getFieldHelp()||this._sDefaultFieldHelp,operators:this._getOperators(),hideOperator:this._oContentFactory.getHideOperator(),maxConditions:this.getMaxConditions(),bindingContext:this.getBindingContext(),asyncParsing:this._asyncParsingCall,navigateCondition:this._oNavigateCondition,delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),preventGetDescription:this._bPreventGetDescription,conditionModel:i.model,conditionModelName:i.name,convertWhitespaces:this.getEditMode()===E.Display||this.getMaxConditions()!==1,control:this,defaultOperatorName:this.getDefaultOperator?this.getDefaultOperator():null};};x.prototype._checkValueInitial=function(i){if(i===null||i===undefined){return true;}if(i===""||(typeof(i)==="string"&&i.match(/^0+$/))){var j=this._oContentFactory.retrieveDataType();var T1=j.parseValue("","string");if(T1===i){return true;}else{try{j.validateValue(T1);}catch(U1){return true;}}}else{var V1=J.call(this);if(this.getTypeUtil().getBaseType(V1)===B.Unit&&Array.isArray(i)&&i.length>1&&(i[0]===undefined||i[0]===null)&&!i[1]){return true;}}return false;};x.prototype._getUnitFormatOptions=function(){if(!this._asyncParsingCall){this._asyncParsingCall=N1.bind(this);}var i=S1.call(this);return{valueType:this._oContentFactory.getUnitType(),originalDateType:this._oContentFactory.getDateOriginalType()||this._oContentFactory.getUnitOriginalType(),additionalType:this._oContentFactory.retrieveDataType(),compositeTypes:this._oContentFactory.getCompositeTypes(),display:this.getDisplay(),fieldHelpID:this.getFieldHelp()||this._sDefaultFieldHelp,operators:["EQ"],hideOperator:true,maxConditions:1,bindingContext:this.getBindingContext(),asyncParsing:this._asyncParsingCall,navigateCondition:this._oNavigateCondition,delegate:this.getControlDelegate(),delegateName:this.getDelegate()&&this.getDelegate().name,payload:this.getPayload(),preventGetDescription:this._bPreventGetDescription,conditionModel:i.model,conditionModelName:i.name,convertWhitespaces:this.getEditMode()===E.Display||this.getEditMode()===E.EditableDisplay,control:this,getConditions:this.getConditions.bind(this)};};function N1(i){var j=z1.call(this);if(j&&j.isOpen()){var T1=document.activeElement;if(T1&&(o(this.getDomRef(),T1)||o(j.getDomRef(),T1))){j.close();}}var U1={};var V1=new Promise(function(W1,X1){U1.resolve=W1;U1.reject=X1;i.then(function(Y1){U1.result=Y1;this._bParseError=false;var Z1=this.getConditions();if(k(Y1,Z1)){P1.call(this,U1);Q1.call(this,U1);}else{U1.waitForUpdate=true;}}.bind(this)).catch(function(Y1){if(Y1&&!(Y1 instanceof P)&&!(Y1 instanceof r)&&!(Y1 instanceof V)){throw Y1;}this._bParseError=true;X1(Y1);Q1.call(this,U1);}.bind(this));}.bind(this));U1.promise=V1;this._aAsyncChanges.push(U1);}function O1(){var j=[];for(var i=0;i<this._aAsyncChanges.length;i++){j.push(this._aAsyncChanges[i].promise);}if(j.length>0){return Promise.all(j).then(function(){return this._getResultForPromise(this.getConditions());}.bind(this));}return null;}x.prototype._getResultForPromise=function(i){return i;};function P1(i){i.resolve(this._getResultForPromise(i.result));}function Q1(j){var T1=false;var i=0;for(i=0;i<this._aAsyncChanges.length;i++){if(j===this._aAsyncChanges[i]){T1=true;break;}}if(T1){this._aAsyncChanges.splice(i,1);}return T1;}x.prototype._getOperators=function(){var i=new RegExp("^\\*(.*)\\*|\\$search$");if(i.test(this.getFieldPath())&&this.getMaxConditions()===1){return["Contains"];}var j=this.getBaseType();if(j===B.Unit){j=B.Numeric;}return b.getOperatorsForType(j);};function R1(j){var T1=this._getOperators();for(var i=0;i<T1.length;i++){if(j===T1[i]){return true;}}return false;}function S1(){var i;var j;var T1=this.getBinding("conditions");if(T1){var U1=T1.getModel();if(U1&&U1.isA("sap.ui.mdc.condition.ConditionModel")){i=U1;var V1=this.getBindingInfo("conditions");if(V1.model){j=V1.model;}else if(V1.parts&&V1.parts.length===1){j=V1.parts[0].model;}}}return{name:j,model:i};}x.prototype._isPropertyInitial=function(i){if(this.isBound(i)&&!this.getBinding(i)){return!Object.prototype.hasOwnProperty.call(this.mProperties,i);}else{return this.isPropertyInitial(i);}};return x;});
